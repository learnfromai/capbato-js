Page Display and Navigation:
WHEN a user navigates to the appointments page
THE SYSTEM SHALL display the appointments page with header navigation, sidebar menu, and main content area

WHEN the appointments page loads
THE SYSTEM SHALL display the page title "Appointments" and show the user's role and username in the header

WHEN the appointments page loads
THE SYSTEM SHALL display an active state for the "Appointments" menu item in the sidebar navigation

WHEN the appointments page loads
THE SYSTEM SHALL show an "Add Appointment" button in the header area

WHEN a user clicks any sidebar navigation item (Dashboard, Patients, Laboratory, Prescriptions, Doctors)
THE SYSTEM SHALL navigate to the corresponding page

WHEN a user with admin role accesses the appointments page
THE SYSTEM SHALL inject an "Accounts" menu item into the sidebar navigation

---

Authentication and Profile Management:
WHEN the appointments page loads
THE SYSTEM SHALL retrieve and display logged-in user's role and username from localStorage

WHEN the appointments page loads
THE SYSTEM SHALL display profile avatar with the first letter of username and consistent color based on username hash

WHEN a user clicks the profile avatar
THE SYSTEM SHALL display a dropdown menu with "Settings" and "Logout" options

WHEN a user clicks outside the profile dropdown
THE SYSTEM SHALL automatically close the dropdown menu

WHEN a user clicks "Settings" from the profile dropdown
THE SYSTEM SHALL display "Settings functionality coming soon!" message

WHEN a user clicks "Logout" from the profile dropdown
THE SYSTEM SHALL clear localStorage authentication data and redirect to the login page

---

Date Filtering and Display Controls:
WHEN the appointments page loads
THE SYSTEM SHALL set the date filter to today's date and load today's appointments by default

WHEN the appointments page loads
THE SYSTEM SHALL display filter controls including a date picker labeled "Select Date:" and "Show All" checkbox

WHEN a user changes the selected date in the date picker
THE SYSTEM SHALL automatically uncheck the "Show All" checkbox and load appointments for the selected date

WHEN a user checks the "Show All" checkbox
THE SYSTEM SHALL load and display all appointments regardless of date, sorted from latest to oldest

WHEN a user unchecks the "Show All" checkbox
THE SYSTEM SHALL load appointments for the currently selected date

WHEN a user clicks the "Appointments" sidebar button
THE SYSTEM SHALL reset to today's date, uncheck "Show All", and load today's appointments

---

Appointments Table Display:
WHEN the appointments page loads
THE SYSTEM SHALL display a table with columns for Patient #, Patient Name, Reason for Visit, Date, Time, Doctor, Status, and Action

WHEN appointments data is loaded
THE SYSTEM SHALL display appointment information in proper case formatting for patient names

WHEN appointments data is loaded
THE SYSTEM SHALL format time in 12-hour format with AM/PM (e.g., "2:30 PM")

WHEN appointments data is loaded
THE SYSTEM SHALL format dates in readable format (e.g., "Jan 15, 2024")

WHEN appointments data is loaded
THE SYSTEM SHALL display appointment status with color-coded styling: green for "Confirmed", red for "Cancelled"

WHEN appointments are loaded
THE SYSTEM SHALL display a count showing total appointments with breakdown of confirmed and cancelled statuses

WHEN "Show All" is active
THE SYSTEM SHALL sort appointments from latest to oldest by date and time

WHEN no appointments are found for today
THE SYSTEM SHALL display "No upcoming appointments for today." message in the table body

WHEN no appointments are found for other selected dates
THE SYSTEM SHALL display "No appointments found." message in the table body

---

Add Appointment Functionality:
WHEN a user clicks the "Add Appointment" button
THE SYSTEM SHALL open an overlay modal containing an iframe with the add appointment form

WHEN the add appointment overlay opens
THE SYSTEM SHALL display a close button and send a "resetForm" message to clear any previous form data

WHEN a user clicks the close button in the add appointment overlay
THE SYSTEM SHALL close the overlay and clear the iframe source

WHEN an appointment is successfully added through the overlay form
THE SYSTEM SHALL receive "appointmentAdded" message, close the overlay, and refresh the appointments list

WHEN an appointment is added with a specific date
THE SYSTEM SHALL set the date picker to that date, uncheck "Show All", and display appointments for that date

---

Appointment Status Management:
WHEN an appointment has "Confirmed" status
THE SYSTEM SHALL display "Modify" and "Cancel" action buttons for that appointment

WHEN an appointment has "Cancelled" status
THE SYSTEM SHALL display only a "Reconfirm" action button for that appointment

WHEN a user clicks the "Cancel" button
THE SYSTEM SHALL display a confirmation modal asking "Are you sure you want to cancel this appointment?"

WHEN a user clicks the "Modify" button
THE SYSTEM SHALL open the appointment form overlay pre-populated with the existing appointment data

WHEN a user clicks the "Reconfirm" button for a cancelled appointment
THE SYSTEM SHALL check if the time slot has less than 4 confirmed appointments

WHEN a user clicks "Reconfirm" and the time slot has available capacity
THE SYSTEM SHALL display a confirmation modal asking "Reconfirm this appointment?"

WHEN a user clicks "Reconfirm" and the time slot is fully booked (4 confirmed appointments)
THE SYSTEM SHALL open the modify appointment form to allow selection of a different time

---

Appointment Status Updates:
WHEN a user confirms appointment cancellation
THE SYSTEM SHALL update the appointment status to "Cancelled", refresh the appointments list, and show a success toast

WHEN a user confirms appointment reconfirmation
THE SYSTEM SHALL update the appointment status to "Confirmed", refresh the appointments list, and show a success toast

WHEN appointment status is updated
THE SYSTEM SHALL send PUT request to "/appointments/cancel/{id}" endpoint with new status

WHEN appointment status update succeeds
THE SYSTEM SHALL reload the appropriate view (filtered date or all appointments) based on current filter state

---

User Feedback and Notifications:
WHEN any appointment action (add, modify, cancel, reconfirm) is successful
THE SYSTEM SHALL display a toast notification with appropriate success message

WHEN any appointment action fails due to validation or server error
THE SYSTEM SHALL display the error message in a toast notification

WHEN toast notifications are displayed
THE SYSTEM SHALL automatically hide them after 2 seconds

WHEN a confirmation modal is displayed
THE SYSTEM SHALL include "Yes" and "No" buttons with appropriate icons and handle the user's choice

WHEN a user clicks "Yes" in a confirmation modal
THE SYSTEM SHALL execute the confirmed action and close the modal

WHEN a user clicks "No" in a confirmation modal
THE SYSTEM SHALL close the modal without performing any action

---

Data Loading and Error Handling:
WHEN the appointments page loads
THE SYSTEM SHALL fetch appointments data from "http://localhost:3001/appointments" endpoint

WHEN appointments data loading succeeds
THE SYSTEM SHALL update the appointments table with the received data

WHEN appointments data loading fails
THE SYSTEM SHALL display "Error loading appointments." message in red color in the table and set appointment count to 0

WHEN appointment status update fails
THE SYSTEM SHALL log error to console and display user-friendly error message

---

State Management and Data Persistence:
WHEN appointments are filtered by a specific date
THE SYSTEM SHALL remember the last viewed date for maintaining context during operations

WHEN appointment data is modified through any action
THE SYSTEM SHALL reload the appropriate view (filtered date or all appointments) based on current filter state

WHEN the page receives "appointmentAdded" message
THE SYSTEM SHALL determine reload strategy based on whether a specific date was provided or current filter state

WHEN "Show All" is checked during appointment operations
THE SYSTEM SHALL reload all appointments instead of date-specific appointments

WHEN appointment operations complete
THE SYSTEM SHALL maintain the user's current filter selection (date-specific or show all) while refreshing data