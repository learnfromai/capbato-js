Page Display and Navigation:
WHEN a user navigates to the appointments page
THE SYSTEM SHALL display the appointments page with header navigation, sidebar menu, and main content area

WHEN the appointments page loads
THE SYSTEM SHALL display the page title "Appointments" and show the user's role and username in the header

WHEN the appointments page loads
THE SYSTEM SHALL display an active state for the "Appointments" menu item in the sidebar navigation

WHEN the appointments page loads
THE SYSTEM SHALL show an "Add Appointment" button in the header area

WHEN a user clicks on any sidebar navigation item
THE SYSTEM SHALL navigate to the corresponding page (Dashboard, Patients, Laboratory, Prescriptions, Doctors)

---

Date Filtering and Control:
WHEN the appointments page loads
THE SYSTEM SHALL set the date filter to today's date and automatically load today's appointments

WHEN the appointments page loads
THE SYSTEM SHALL display filter controls including a date picker labeled "Select Date:" and "Show All" checkbox

WHEN a user changes the selected date in the date picker
THE SYSTEM SHALL automatically uncheck the "Show All" checkbox and load appointments for the selected date

WHEN a user checks the "Show All" checkbox
THE SYSTEM SHALL load and display all appointments regardless of date, sorted from latest to oldest

WHEN a user unchecks the "Show All" checkbox
THE SYSTEM SHALL load appointments for the currently selected date

---

Appointments Table Display:
WHEN appointments are loaded
THE SYSTEM SHALL display appointments in a table with columns: Patient #, Patient Name, Reason for Visit, Date, Time, Doctor, Status, Action

WHEN appointments data is loaded
THE SYSTEM SHALL display appointment information in proper case formatting for patient names and readable date/time formats

WHEN appointments are displayed
THE SYSTEM SHALL format time in 12-hour format with AM/PM and dates in readable format (e.g., "Jan 15, 2024")

WHEN appointments data is loaded
THE SYSTEM SHALL display appointment status with color-coded badges (green for Confirmed, red for Cancelled)

WHEN appointments are loaded
THE SYSTEM SHALL display a count showing total appointments with breakdown of confirmed and cancelled statuses

WHEN no appointments are found for today
THE SYSTEM SHALL display "No upcoming appointments for today." message in the table

WHEN no appointments are found for a selected date
THE SYSTEM SHALL display "No appointments found." message in the table

WHEN appointment data fails to load
THE SYSTEM SHALL display "Error loading appointments." message in red color in the table

---

Add Appointment Integration:
WHEN a user clicks the "Add Appointment" button
THE SYSTEM SHALL open an overlay modal containing an iframe with the add appointment form

WHEN the add appointment overlay opens
THE SYSTEM SHALL display a close button and reset any previous form data by sending "resetForm" message

WHEN a user clicks the close button in the add appointment overlay
THE SYSTEM SHALL close the overlay and clear the iframe source

WHEN an appointment is successfully added through the overlay form
THE SYSTEM SHALL close the overlay, refresh the appointments list, and show a success toast notification

WHEN an appointment is added with a specific date
THE SYSTEM SHALL set the date picker to that date, uncheck "Show All", and display appointments for that date

---

Appointment Status Management:
WHEN an appointment has "Confirmed" status
THE SYSTEM SHALL display "Modify" and "Cancel" action buttons for that appointment

WHEN an appointment has "Cancelled" status
THE SYSTEM SHALL display only a "Reconfirm" action button for that appointment

WHEN a user clicks the "Cancel" button
THE SYSTEM SHALL display a confirmation modal asking "Are you sure you want to cancel this appointment?"

WHEN a user confirms appointment cancellation
THE SYSTEM SHALL update the appointment status to "Cancelled", refresh the appointments list, and show a success toast

WHEN a user clicks the "Reconfirm" button for a cancelled appointment
THE SYSTEM SHALL check if the time slot has available capacity (less than 4 confirmed appointments)

WHEN a user confirms appointment reconfirmation and the time slot is available
THE SYSTEM SHALL update the appointment status to "Confirmed", refresh the appointments list, and show a success toast

WHEN a user attempts to reconfirm an appointment but the time slot is fully booked
THE SYSTEM SHALL open the modify appointment form to allow selection of a different time

WHEN a user clicks the "Modify" button
THE SYSTEM SHALL open the appointment form overlay pre-populated with the existing appointment data by sending "editAppointment" message

---

User Feedback and Confirmation:
WHEN any appointment action (add, modify, cancel, reconfirm) is successful
THE SYSTEM SHALL display a toast notification with appropriate success message for 2 seconds

WHEN any appointment action fails due to validation or server error
THE SYSTEM SHALL display the error message in a toast notification

WHEN a confirmation modal is displayed
THE SYSTEM SHALL include "Yes" and "No" buttons with appropriate icons and handle the user's choice

WHEN a user clicks "Yes" in a confirmation modal
THE SYSTEM SHALL execute the confirmed action and close the modal

WHEN a user clicks "No" in a confirmation modal
THE SYSTEM SHALL cancel the action and close the modal without making changes

---

Authentication and Profile Features:
WHEN a user with "admin" role accesses the appointments page
THE SYSTEM SHALL inject an "Accounts" menu item into the sidebar navigation

WHEN the user profile avatar is clicked
THE SYSTEM SHALL display a dropdown menu with "Settings" and "Logout" options

WHEN a user clicks "Settings" from the profile dropdown
THE SYSTEM SHALL display "Settings functionality coming soon!" alert message

WHEN a user clicks "Logout" from the profile dropdown
THE SYSTEM SHALL clear localStorage authentication data and redirect to the login page

WHEN a user clicks outside the profile dropdown
THE SYSTEM SHALL automatically close the dropdown menu

WHEN the appointments page loads
THE SYSTEM SHALL display profile avatar with first letter of username and consistent color based on username hash

---

Backend Integration and Error Handling:
WHEN loading appointments data
THE SYSTEM SHALL make HTTP GET request to "/appointments" endpoint and handle response appropriately

WHEN updating appointment status
THE SYSTEM SHALL make HTTP PUT request to "/appointments/cancel/{id}" endpoint with new status

WHEN appointment operations succeed
THE SYSTEM SHALL refresh appointments table based on current filter settings (date-specific or show all)

WHEN appointment operations fail due to network or server errors
THE SYSTEM SHALL display error messages and maintain current table state

---

Data Persistence and State Management:
WHEN appointments are filtered by a specific date
THE SYSTEM SHALL remember the last viewed date for maintaining context during operations

WHEN appointment data is modified through any action
THE SYSTEM SHALL reload the appropriate view (filtered date or all appointments) based on current filter state

WHEN the page is refreshed or revisited
THE SYSTEM SHALL restore the filter state and load the appropriate appointments view

WHEN appointment operations complete
THE SYSTEM SHALL maintain the user's current filter selection (date-specific or show all) while refreshing data