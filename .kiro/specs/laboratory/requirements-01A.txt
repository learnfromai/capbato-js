Laboratory Page Display:
WHEN a user navigates to the laboratory page 
THE SYSTEM SHALL display the laboratory interface with header, sidebar navigation, and main content area

WHEN the laboratory page loads 
THE SYSTEM SHALL highlight "Laboratory" as the active navigation item in the sidebar

WHEN the laboratory page is displayed 
THE SYSTEM SHALL show the page title "Laboratory" and an "Add Lab Test" button in the header

WHEN the laboratory page loads 
THE SYSTEM SHALL display user information (role and username) in the top navbar with profile avatar

---

Laboratory Table Display and Data Loading:
WHEN the laboratory page loads 
THE SYSTEM SHALL fetch and display a table of lab requests with columns: Patient #, Patient's Name, Status, Results

WHEN laboratory data is loading 
THE SYSTEM SHALL make API call to retrieve all lab request entries from the backend

WHEN laboratory data is successfully loaded 
THE SYSTEM SHALL group lab requests by patient and display the most recent status for each patient

WHEN no lab data is available 
THE SYSTEM SHALL display an empty table with proper column headers

WHEN lab data contains multiple tests for the same patient 
THE SYSTEM SHALL consolidate them into a single row showing overall status (Pending if any test is pending, Complete if all are complete)

---

Lab Request Table Interaction:
WHEN a user clicks the "View" button for a patient row 
THE SYSTEM SHALL open a floating modal showing detailed lab tests for that specific patient

WHEN the detailed lab tests modal is displayed 
THE SYSTEM SHALL show patient information (Patient # and Patient's Name) in the modal header

WHEN the detailed lab tests modal loads 
THE SYSTEM SHALL display a table with columns: Lab Test, Date, Status, Results for each test category

WHEN no lab tests exist for a patient 
THE SYSTEM SHALL display "No test results available" message in the modal table

WHEN lab tests are displayed in the modal 
THE SYSTEM SHALL group tests by category (ROUTINE, SEROLOGY & IMMUNOLOGY, BLOOD CHEMISTRY, MISCELLANEOUS TEST, THYROID FUNCTION TEST)

---

Lab Test Status Management and Actions:
WHEN a lab test has "Complete" status in the detailed modal 
THE SYSTEM SHALL display "View" and "Edit" action buttons for that test

WHEN a lab test has "Pending" status in the detailed modal 
THE SYSTEM SHALL display "Add Result" and "Cancel" action buttons for that test

WHEN a user clicks "Add Result" button 
THE SYSTEM SHALL open the lab overlay iframe with appropriate form for entering test results

WHEN a user clicks "View" button on a completed test 
THE SYSTEM SHALL open the lab overlay iframe in read-only mode to display test results

WHEN a user clicks "Edit" button on a completed test 
THE SYSTEM SHALL open the lab overlay iframe in edit mode to modify test results

WHEN a user clicks "Cancel" button 
THE SYSTEM SHALL display a confirmation modal asking "Are you sure you want to cancel this lab test?"

---

Add Lab Test Functionality:
WHEN a user clicks the "Add Lab Test" button 
THE SYSTEM SHALL open the lab overlay modal with iframe containing the lab request form

WHEN the lab request form overlay is opened 
THE SYSTEM SHALL display the lab request form with patient selection, test categories, and submission controls

WHEN the lab overlay is displayed 
THE SYSTEM SHALL provide a close button to dismiss the overlay

WHEN a user clicks the close button on lab overlay 
THE SYSTEM SHALL close the overlay and clear the iframe source

---

Modal Management and Navigation:
WHEN the lab overlay iframe loads 
THE SYSTEM SHALL send patient and test data to the iframe via postMessage API

WHEN the lab overlay receives a close message from iframe 
THE SYSTEM SHALL close the overlay and refresh laboratory data if needed

WHEN closing lab overlay after adding results 
THE SYSTEM SHALL refresh the lab test modal in place without closing it

WHEN closing lab overlay after other actions 
THE SYSTEM SHALL refresh the main laboratory table to reflect changes

WHEN URL parameters contain modal opening instructions 
THE SYSTEM SHALL automatically open the appropriate modal or overlay after page load

---

Form Validation and Data Submission:
WHEN lab request form is submitted via iframe 
THE SYSTEM SHALL validate all required fields before submission

WHEN lab request submission is successful 
THE SYSTEM SHALL display success toast notification and refresh the laboratory table

WHEN lab request submission fails 
THE SYSTEM SHALL display error message and allow user to retry

WHEN lab results are updated 
THE SYSTEM SHALL update the database and refresh the display to show new status

---

Confirmation and Cancellation:
WHEN cancel confirmation modal is displayed 
THE SYSTEM SHALL provide "Yes" and "No" buttons for user choice

WHEN user clicks "Yes" in cancel confirmation 
THE SYSTEM SHALL update the lab test status to "Canceled" and close the confirmation modal

WHEN user clicks "No" in cancel confirmation 
THE SYSTEM SHALL close the confirmation modal without making changes

---

Toast Notifications and User Feedback:
WHEN a lab-related action is completed successfully 
THE SYSTEM SHALL display a toast notification with success message

WHEN toast notification is displayed 
THE SYSTEM SHALL automatically hide the toast after 3 seconds

WHEN an error occurs during lab operations 
THE SYSTEM SHALL display appropriate error messages to the user

---

User Authentication and Profile Management:
WHEN the laboratory page loads 
THE SYSTEM SHALL display the logged-in user's role and username in the navbar

WHEN user's first letter is displayed in profile avatar 
THE SYSTEM SHALL use a consistent color based on username hash

WHEN user clicks on profile avatar 
THE SYSTEM SHALL display dropdown menu with "Settings" and "Logout" options

WHEN user clicks "Logout" from profile dropdown 
THE SYSTEM SHALL clear local storage and redirect to login page

WHEN user has admin role 
THE SYSTEM SHALL add "Accounts" option to the sidebar navigation

---

Responsive Design and Accessibility:
WHEN laboratory page is viewed on mobile devices 
THE SYSTEM SHALL adapt the layout for smaller screens

WHEN table content is too wide for display 
THE SYSTEM SHALL implement horizontal scrolling or responsive design

WHEN modals are displayed 
THE SYSTEM SHALL center them on screen and provide proper overlay background

---

Data Refresh and Real-time Updates:
WHEN laboratory data changes due to user actions 
THE SYSTEM SHALL automatically refresh the display without requiring page reload

WHEN multiple users are working with lab data 
THE SYSTEM SHALL maintain data consistency through proper API calls

WHEN returning to laboratory page from other sections 
THE SYSTEM SHALL reload fresh data from the server

---

Error Handling and Network Issues:
WHEN API calls fail due to network issues 
THE SYSTEM SHALL display appropriate error messages to the user

WHEN laboratory data cannot be loaded 
THE SYSTEM SHALL show error state while maintaining page functionality

WHEN backend is unavailable 
THE SYSTEM SHALL gracefully handle errors and provide user feedback