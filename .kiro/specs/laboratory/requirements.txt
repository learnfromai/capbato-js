Laboratory Page Display:
WHEN a user navigates to the laboratory page 
THE SYSTEM SHALL display the laboratory interface with clinic branding header, sidebar navigation, and main content area

WHEN the laboratory page loads 
THE SYSTEM SHALL show "Laboratory" as the active menu item in the sidebar navigation

WHEN the laboratory page is displayed 
THE SYSTEM SHALL show the page title "Laboratory" centered in the header with an "Add Lab Test" button aligned to the right

WHEN the laboratory page loads 
THE SYSTEM SHALL display a table with columns for "Patient #", "Patient's Name", "Status", and "Results"

---

Data Loading and Display:
WHEN the laboratory page loads 
THE SYSTEM SHALL fetch lab request data from the "/api/lab_requests" endpoint

WHEN lab request data is received 
THE SYSTEM SHALL group lab tests by categories: ROUTINE, SEROLOGY & IMMUNOLOGY, BLOOD CHEMISTRY, MISCELLANEOUS TEST, and THYROID FUNCTION TEST

WHEN displaying patient names 
THE SYSTEM SHALL format full names in proper title case with first name, middle name, and last name structure

WHEN determining overall patient status 
THE SYSTEM SHALL display "Pending" if any test is pending, "Complete" if all tests are complete, or use the most recent test status for mixed states

WHEN the table is populated 
THE SYSTEM SHALL show patient ID, formatted patient name, overall status, and a "View" button for each patient with lab requests

---

Lab Test Modal Management:
WHEN a user clicks the "View" button for a patient 
THE SYSTEM SHALL open a floating modal displaying detailed lab test information

WHEN the lab test modal opens 
THE SYSTEM SHALL display patient header information including Patient # and Patient's Name

WHEN the modal content loads 
THE SYSTEM SHALL show a table with columns for "Lab Test", "Date", "Status", and "Results"

WHEN no test results are available for a patient 
THE SYSTEM SHALL display "No test results available" message in the modal

WHEN test results exist 
THE SYSTEM SHALL display grouped test names, formatted dates, status, and appropriate action buttons

WHEN a user clicks the close button on the modal 
THE SYSTEM SHALL close the lab test modal and return to the main laboratory view

---

Lab Form Overlay System:
WHEN a user clicks "Add Lab Test" button 
THE SYSTEM SHALL open an overlay with iframe loading "lab-request-form.html"

WHEN a user clicks "Add Result" button 
THE SYSTEM SHALL open an overlay with appropriate form based on test type (blood-chemistry.html, urinalysis.html, fecalysis.html, hematology.html, or serology-immunology.html)

WHEN the lab form overlay loads 
THE SYSTEM SHALL pass patient data including patient_id, patient_name, request_date, and selectedTests via postMessage

WHEN a user clicks the overlay close button 
THE SYSTEM SHALL close the overlay, clear the iframe source, and refresh the laboratory data if needed

WHEN lab form submission is completed 
THE SYSTEM SHALL close the overlay, display success toast message, and refresh the appropriate views

---

User Interactions and Actions:
WHEN a lab test status is "Complete" 
THE SYSTEM SHALL display "View" and "Edit" buttons for that test

WHEN a lab test status is "Pending" 
THE SYSTEM SHALL display "Add Result" and "Cancel" buttons for that test

WHEN a user clicks "View" button for a completed test 
THE SYSTEM SHALL open the lab overlay in read-only mode with existing test results

WHEN a user clicks "Edit" button for a completed test 
THE SYSTEM SHALL open the lab overlay in edit mode allowing result modifications

WHEN a user clicks "Cancel" button for a pending test 
THE SYSTEM SHALL display a confirmation modal asking "Are you sure you want to cancel this lab test?"

WHEN a user confirms test cancellation 
THE SYSTEM SHALL update the test status to "Canceled" and close the confirmation modal

WHEN a user declines test cancellation 
THE SYSTEM SHALL close the confirmation modal without making changes

---

Authentication and Authorization:
WHEN the laboratory page loads 
THE SYSTEM SHALL display the logged-in user's role and username in the top navigation

WHEN the laboratory page loads 
THE SYSTEM SHALL generate a profile avatar with the first letter of the username and a consistent color

WHEN a user clicks the profile avatar 
THE SYSTEM SHALL display a dropdown menu with "Settings" and "Logout" options

WHEN a user clicks "Logout" from the profile dropdown 
THE SYSTEM SHALL clear localStorage authentication data and redirect to login.html

WHEN the logged-in user has admin role 
THE SYSTEM SHALL inject an "Accounts" menu item in the sidebar navigation

WHEN navigation menu items are clicked 
THE SYSTEM SHALL redirect to the corresponding pages (dashboard, appointments, patients, prescriptions, doctor-schedule)

---

Test Categories and Status Management:
WHEN displaying ROUTINE tests 
THE SYSTEM SHALL include CBC with Platelet, Pregnancy Test, Urinalysis, Fecalysis, and Occult Blood Test

WHEN displaying SEROLOGY & IMMUNOLOGY tests 
THE SYSTEM SHALL include Hepa B Screening, Hepa A Screening, Hepatitis Profile, VDRL/RPR, Dengue NS1, and CA 125/CEA/PSA

WHEN displaying BLOOD CHEMISTRY tests 
THE SYSTEM SHALL include FBS, BUN, Creatinine, Blood Uric Acid, Lipid Profile, SGOT, SGPT, ALP, Sodium Na, Potassium K+, and HBA1C

WHEN displaying MISCELLANEOUS TEST 
THE SYSTEM SHALL include ECG

WHEN displaying THYROID FUNCTION TEST 
THE SYSTEM SHALL include T3, T4, FT3, FT4, and TSH

WHEN lab data is updated via overlay forms 
THE SYSTEM SHALL refresh the main laboratory table and modal content in real-time

WHEN toast messages are triggered 
THE SYSTEM SHALL display notifications at the top center of the page for 3 seconds

---

Responsive Design and User Experience:
WHEN the laboratory page is viewed on mobile devices 
THE SYSTEM SHALL adjust the layout with responsive sidebar and table formatting

WHEN table content exceeds column width 
THE SYSTEM SHALL truncate text with ellipsis while maintaining proper alignment

WHEN the page loads 
THE SYSTEM SHALL apply proper styling with gradient background, rounded corners, and shadow effects

WHEN buttons are hovered 
THE SYSTEM SHALL provide visual feedback with color changes and scale transformations

WHEN URL parameters include "openModal" with patient information 
THE SYSTEM SHALL automatically open the appropriate modal or overlay after page load