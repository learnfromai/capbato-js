Page Load and User Session:
WHEN a user navigates to the dashboard page
THE SYSTEM SHALL assume authenticated access and load dashboard content

WHEN dashboard page loads
THE SYSTEM SHALL read user role and username from localStorage or sessionStorage for display

---

Header Display and User Information:
WHEN the dashboard page loads with authenticated user
THE SYSTEM SHALL display the clinic logo and name "M.G. Amores Medical Clinic" in the header

WHEN authenticated user information is available
THE SYSTEM SHALL display the user's role (capitalized) and username in the top-right header area

WHEN user information is loaded
THE SYSTEM SHALL generate profile avatar with user initials and random color based on username

---

Profile Avatar and Dropdown Functionality:
WHEN user clicks on the profile avatar
THE SYSTEM SHALL toggle the profile dropdown menu with Settings and Logout options

WHEN user clicks outside the profile dropdown
THE SYSTEM SHALL close the dropdown menu

WHEN user clicks the Settings option in dropdown
THE SYSTEM SHALL display "Settings functionality coming soon!" alert and close dropdown

WHEN user clicks the Logout option in dropdown
THE SYSTEM SHALL clear all authentication data from localStorage and redirect to login.html

---

Sidebar Navigation:
WHEN the dashboard page loads
THE SYSTEM SHALL display fixed sidebar with navigation items: Dashboard, Appointments, Patients, Laboratory, Prescriptions, Doctors

WHEN user role is admin
THE SYSTEM SHALL dynamically add "Accounts" navigation item to the sidebar

WHEN dashboard page is active
THE SYSTEM SHALL highlight the Dashboard navigation item as active with visual indicators

WHEN user clicks any sidebar navigation item
THE SYSTEM SHALL navigate to the corresponding page (appointments.html, patients.html, etc.)

---

Summary Cards Display:
WHEN the dashboard loads
THE SYSTEM SHALL display three summary cards: Doctor, Current Patient, and Total Appointments

WHEN doctor information is available
THE SYSTEM SHALL display "Dr. Smith (Assigned)" in the Doctor card with doctor icon

WHEN current patient data is loaded
THE SYSTEM SHALL display the current patient name or "N/A" if no current patient

WHEN current patient calculation fails
THE SYSTEM SHALL display "Error" in the Current Patient card

WHEN today's appointment count is fetched
THE SYSTEM SHALL display the total number of confirmed appointments for today with today's date

WHEN today's date is displayed
THE SYSTEM SHALL format the date as "DD MMM YYYY" format

---

Today's Appointments Table:
WHEN the dashboard loads
THE SYSTEM SHALL fetch and display today's appointments in a table format

WHEN appointments data is available
THE SYSTEM SHALL display columns: Patient #, Patient, Reason for visit, Contact, Time, Doctor, Status

WHEN displaying appointment times
THE SYSTEM SHALL format times in 12-hour format with AM/PM

WHEN displaying patient names
THE SYSTEM SHALL format names with proper capitalization

WHEN appointment time has passed
THE SYSTEM SHALL filter out appointments that are earlier than current time

WHEN patient name is clicked in appointments table
THE SYSTEM SHALL navigate to patientinfo.html with patient_id parameter

WHEN "See All" link is clicked
THE SYSTEM SHALL navigate to appointments.html page

WHEN appointment data fetch fails
THE SYSTEM SHALL log error to console and continue operation

---

Lab Test Results (Doctor Role):
WHEN user role is doctor
THE SYSTEM SHALL display lab test results section below appointments table

WHEN user role is not doctor
THE SYSTEM SHALL hide the lab test results section

WHEN lab test results are loaded for doctors
THE SYSTEM SHALL display completed lab tests for today with columns: Patient #, Patient Name, Lab Test, Date, Status, Action

WHEN "View" button is clicked on lab result
THE SYSTEM SHALL open lab result in modal overlay with appropriate form based on test type

WHEN no lab tests are completed for today
THE SYSTEM SHALL display "No completed lab tests for today" message

---

Data Refresh and Real-time Updates:
WHEN dashboard is loaded
THE SYSTEM SHALL automatically refresh appointment data every 10 seconds

WHEN dashboard is loaded
THE SYSTEM SHALL automatically refresh current patient data every 10 seconds

WHEN dashboard is loaded and user is doctor
THE SYSTEM SHALL automatically refresh lab test results every 30 seconds

WHEN data refresh fails
THE SYSTEM SHALL log error to console and continue attempting updates

---

Navigation and Redirects:
WHEN patient link is clicked in appointments or lab results
THE SYSTEM SHALL navigate to patientinfo.html with patient_id as URL parameter

WHEN "See All" link is clicked in appointments section
THE SYSTEM SHALL navigate to appointments.html

WHEN "See All" link is clicked in lab results section
THE SYSTEM SHALL navigate to laboratory.html

---

Modal Overlay for Lab Results:
WHEN "View" button is clicked on lab result
THE SYSTEM SHALL open modal overlay with iframe containing appropriate lab form

WHEN lab modal is opened
THE SYSTEM SHALL determine correct form (urinalysis.html, blood-chemistry.html, etc.) based on test type

WHEN lab modal iframe loads
THE SYSTEM SHALL send test data to iframe via postMessage for display

WHEN close button (X) is clicked on modal
THE SYSTEM SHALL close the modal and clear iframe source

WHEN user clicks outside modal container
THE SYSTEM SHALL close the modal overlay

WHEN Escape key is pressed while modal is open
THE SYSTEM SHALL close the modal overlay

WHEN modal receives closeLabOverlay message from iframe
THE SYSTEM SHALL close the modal and optionally refresh lab results table