Authentication and Page Load:
WHEN a user navigates to the dashboard page (index.html)
THE SYSTEM SHALL verify user authentication status from localStorage or sessionStorage

WHEN the dashboard page loads without valid authentication
THE SYSTEM SHALL redirect the user to the login page

WHEN the dashboard page loads for an authenticated user
THE SYSTEM SHALL display the dashboard content with user role and username information

WHEN the dashboard page loads
THE SYSTEM SHALL set the page title to "M.G. Amores Medical Clinic"

---

Header Display and Branding:
WHEN the dashboard page loads
THE SYSTEM SHALL display a fixed header with clinic logo, clinic name "M.G. Amores Medical Clinic", user role, username, and profile avatar

WHEN displaying user information in the header
THE SYSTEM SHALL show the user role with proper capitalization (Admin/Doctor/Receptionist) and username below it

WHEN generating the profile avatar
THE SYSTEM SHALL create initials from the username and assign a consistent random color based on the username

---

Profile Avatar and Dropdown Management:
WHEN a user clicks on the profile avatar
THE SYSTEM SHALL toggle a dropdown menu displaying "Settings" and "Logout" options

WHEN a user clicks outside the profile dropdown
THE SYSTEM SHALL close the dropdown menu

WHEN a user clicks the "Settings" option in the profile dropdown
THE SYSTEM SHALL display "Settings functionality coming soon!" alert and close the dropdown

WHEN a user clicks the "Logout" option in the profile dropdown
THE SYSTEM SHALL clear all authentication data from localStorage and redirect to login.html

---

Sidebar Navigation:
WHEN the dashboard page loads
THE SYSTEM SHALL display a fixed sidebar with navigation items: Dashboard, Appointments, Patients, Laboratory, Prescriptions, and Doctors

WHEN the dashboard page loads for an admin user
THE SYSTEM SHALL add an "Accounts" navigation item to the sidebar

WHEN the dashboard page is active
THE SYSTEM SHALL highlight the Dashboard navigation item as active with visual styling

WHEN a user hovers over any sidebar navigation item
THE SYSTEM SHALL provide visual feedback with color changes and hover effects

WHEN a user clicks any sidebar navigation item
THE SYSTEM SHALL navigate to the corresponding page (appointments.html, patients.html, etc.)

---

Summary Cards Display:
WHEN the dashboard page loads
THE SYSTEM SHALL display three summary cards: Doctor, Current Patient, and Total Appointments

WHEN displaying the Doctor card
THE SYSTEM SHALL show "Dr. Smith (Assigned)" with doctor icon and blue background

WHEN displaying the Current Patient card
THE SYSTEM SHALL calculate and show the patient with appointment time closest to and before current time, or "N/A" if none found

WHEN current patient calculation fails
THE SYSTEM SHALL display "Error" in the Current Patient card

WHEN displaying the Total Appointments card
THE SYSTEM SHALL fetch and show the count of confirmed appointments for today with today's date formatted as "DD MMM YYYY"

---

Today's Appointments Table:
WHEN the dashboard page loads
THE SYSTEM SHALL display "Today's Appointments" table with columns: Patient #, Patient, Reason for visit, Contact, Time, Doctor, Status

WHEN loading today's appointments
THE SYSTEM SHALL fetch appointment data from the API and filter to show only appointments at or after the current time

WHEN displaying appointment times
THE SYSTEM SHALL format times in 12-hour format with AM/PM notation

WHEN displaying patient names
THE SYSTEM SHALL format names with proper title case capitalization

WHEN displaying patient names in the appointments table
THE SYSTEM SHALL create clickable links that navigate to patientinfo.html with patient_id parameter

WHEN the appointments table is displayed
THE SYSTEM SHALL include a "See All" link at the bottom that navigates to appointments.html

WHEN appointment data fails to load
THE SYSTEM SHALL log errors to console and display empty table structure

---

Lab Test Results Display (Doctor Role):
WHEN the dashboard page loads for a user with doctor role
THE SYSTEM SHALL display "Today's Lab Test Results" table section below the appointments table

WHEN the dashboard page loads for a non-doctor user
THE SYSTEM SHALL hide the lab test results section entirely

WHEN displaying lab test results for doctors
THE SYSTEM SHALL fetch completed lab tests and filter to show only tests completed today

WHEN displaying lab test results
THE SYSTEM SHALL show columns: Patient #, Patient Name, Lab Test, Date, Status, Action

WHEN no lab test results are completed for today
THE SYSTEM SHALL display "No completed lab tests for today" message in the table

WHEN displaying lab test patient names
THE SYSTEM SHALL create clickable links that navigate to patientinfo.html with patient_id parameter

WHEN displaying lab test dates
THE SYSTEM SHALL format dates as "MMM DD, YYYY" format

WHEN displaying lab test status
THE SYSTEM SHALL show status badges with appropriate color coding (green for Complete)

WHEN displaying lab test action buttons
THE SYSTEM SHALL show a "View" button with eye icon for each completed test

WHEN the lab results table is displayed
THE SYSTEM SHALL include a "See All" link at the bottom that navigates to laboratory.html

---

Lab Results Modal Functionality:
WHEN a doctor clicks the "View" button for a lab test result
THE SYSTEM SHALL open a modal overlay displaying the lab test details

WHEN opening the lab results modal
THE SYSTEM SHALL determine the correct lab form type (urinalysis, blood-chemistry, hematology, serology-immunology, fecalysis) based on the test name

WHEN the lab results modal opens
THE SYSTEM SHALL load the appropriate form in an iframe and send test data via postMessage for read-only display

WHEN the lab results modal is displayed
THE SYSTEM SHALL show a close button (X) in the top-right corner

WHEN a user clicks the close button, clicks outside the modal, or presses Escape key
THE SYSTEM SHALL close the modal and clear the iframe source

WHEN the lab form within the modal sends a close message
THE SYSTEM SHALL close the modal and optionally refresh lab results if data was updated

---

Real-time Data Updates:
WHEN the dashboard page is active
THE SYSTEM SHALL automatically refresh appointment data (total count and appointments table) every 10 seconds

WHEN the dashboard page is active
THE SYSTEM SHALL automatically refresh current patient information every 10 seconds

WHEN the dashboard page is active for doctor users
THE SYSTEM SHALL automatically refresh lab test results every 30 seconds

WHEN any data refresh occurs
THE SYSTEM SHALL update the display without requiring user interaction or page reload

WHEN data fetching fails during refresh
THE SYSTEM SHALL log errors to console and maintain existing display data

---

Error Handling and Fallbacks:
WHEN API endpoints are unreachable for appointments data
THE SYSTEM SHALL display "0" for appointment counts and "Error" for current patient

WHEN API endpoints are unreachable for lab test data
THE SYSTEM SHALL display "Error loading lab results" message in the lab results table

WHEN appointment data is missing or incomplete
THE SYSTEM SHALL display "N/A" for missing fields rather than showing undefined values

WHEN lab test data cannot be loaded for viewing
THE SYSTEM SHALL display "Error loading lab test data" alert

WHEN any navigation errors occur
THE SYSTEM SHALL handle gracefully without breaking the user interface

---

User Interactions and Navigation:
WHEN patient links are clicked in appointments or lab results tables
THE SYSTEM SHALL navigate to patientinfo.html with patient_id as URL parameter

WHEN "See All" links are clicked
THE SYSTEM SHALL navigate to the corresponding full page (appointments.html or laboratory.html)

WHEN any clickable element is hovered
THE SYSTEM SHALL provide visual feedback through color changes or transformations

WHEN the page encounters any interaction errors
THE SYSTEM SHALL handle gracefully without breaking functionality

---

Responsive Design and Styling:
WHEN the dashboard is displayed on different screen sizes
THE SYSTEM SHALL maintain usable layout and navigation functionality

WHEN the browser window is resized below 992px width
THE SYSTEM SHALL adapt the layout for better mobile experience

WHEN tables contain long text content
THE SYSTEM SHALL handle text overflow with ellipsis and maintain table structure

WHEN cards and tables are displayed
THE SYSTEM SHALL apply consistent shadow effects, border radius, and gradient background

WHEN status information is displayed
THE SYSTEM SHALL use color coding to indicate different states (complete, pending, cancelled)

WHEN interactive elements are displayed
THE SYSTEM SHALL provide appropriate hover effects and transition animations

WHEN the dashboard loads
THE SYSTEM SHALL apply consistent typography using 'Segoe UI' font family

WHEN modals and dropdowns are displayed
THE SYSTEM SHALL ensure proper z-index layering above other page elements

---

Performance and Initialization:
WHEN the dashboard page loads
THE SYSTEM SHALL initialize all event listeners and modal functionality without blocking the UI

WHEN the dashboard DOM is ready
THE SYSTEM SHALL call initialization functions: updateTodayDate(), fetchDoctorOfDay(), refreshDashboardData(), fetchCurrentPatient(), loadLabTestResults()

WHEN auto-refresh intervals are active
THE SYSTEM SHALL efficiently update only necessary DOM elements without causing layout shifts

WHEN multiple API calls are made simultaneously
THE SYSTEM SHALL handle them asynchronously to maintain UI responsiveness

WHEN the dashboard receives new data from API calls
THE SYSTEM SHALL update the display smoothly without causing flashing or visual disruption