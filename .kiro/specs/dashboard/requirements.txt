Page Load and User Session:
WHEN a user navigates to the dashboard page (index.html)
THE SYSTEM SHALL display the page with fixed header, sidebar navigation, and main content area

WHEN the dashboard page loads
THE SYSTEM SHALL read user role and username from localStorage or sessionStorage for display

WHEN the dashboard page loads
THE SYSTEM SHALL set the page title to "M.G. Amores Medical Clinic"

---

Header Display and User Information:
WHEN the dashboard page loads
THE SYSTEM SHALL display a fixed header with clinic logo, clinic name "M.G. Amores Medical Clinic", user role, username, and profile avatar

WHEN user role information is available
THE SYSTEM SHALL display the user's role with proper capitalization (first letter uppercase) in the header

WHEN username information is available
THE SYSTEM SHALL display the username below the role in the header

WHEN user information is loaded
THE SYSTEM SHALL generate a profile avatar with user initials and random color based on username hash

---

Profile Avatar and Dropdown Functionality:
WHEN a user clicks on the profile avatar
THE SYSTEM SHALL toggle the profile dropdown menu with "Settings" and "Logout" options

WHEN a user clicks outside the profile dropdown
THE SYSTEM SHALL close the dropdown menu

WHEN a user clicks the "Settings" option in the profile dropdown
THE SYSTEM SHALL display "Settings functionality coming soon!" alert and close the dropdown

WHEN a user clicks the "Logout" option in the profile dropdown
THE SYSTEM SHALL clear all authentication data from localStorage and redirect to login.html

---

Sidebar Navigation:
WHEN the dashboard page loads
THE SYSTEM SHALL display a fixed sidebar with navigation items: Dashboard, Appointments, Patients, Laboratory, Prescriptions, and Doctors

WHEN the dashboard page loads for an admin user
THE SYSTEM SHALL dynamically add "Accounts" navigation item to the sidebar via JavaScript

WHEN the dashboard page is active
THE SYSTEM SHALL mark the "Dashboard" navigation item as active with visual highlighting

WHEN a user clicks any sidebar navigation item
THE SYSTEM SHALL navigate to the corresponding page (appointments.html, patients.html, etc.)

WHEN a user hovers over a sidebar navigation item
THE SYSTEM SHALL show hover effect with color change and visual feedback

---

Summary Cards Display:
WHEN the dashboard loads
THE SYSTEM SHALL display three summary cards: Doctor, Current Patient, and Total Appointments

WHEN the doctor information is displayed
THE SYSTEM SHALL show "Dr. Smith (Assigned)" in the Doctor card with doctor icon

WHEN current patient data is loaded
THE SYSTEM SHALL calculate and display the patient with appointment time closest to and before current time

WHEN no current patient is found
THE SYSTEM SHALL display "N/A" in the Current Patient card

WHEN current patient calculation fails
THE SYSTEM SHALL display "Error" in the Current Patient card

WHEN today's appointment count is fetched
THE SYSTEM SHALL display the total number of confirmed appointments for today

WHEN today's date is displayed in the Total Appointments card
THE SYSTEM SHALL format the date in "DD MMM YYYY" format

---

Today's Appointments Table:
WHEN the dashboard loads
THE SYSTEM SHALL display "Today's Appointments" table with columns: Patient #, Patient, Reason for visit, Contact, Time, Doctor, Status

WHEN appointments data is available
THE SYSTEM SHALL filter appointments to show only those with appointment times at or after the current time

WHEN displaying appointment times
THE SYSTEM SHALL format times in 12-hour format with AM/PM notation

WHEN displaying patient names
THE SYSTEM SHALL format names with proper capitalization (first letter of each word capitalized)

WHEN patient names are displayed in the appointments table
THE SYSTEM SHALL create clickable links that navigate to patientinfo.html with patient_id parameter

WHEN the appointments table is displayed
THE SYSTEM SHALL include a "See All" link that navigates to appointments.html

WHEN no appointments are available for display
THE SYSTEM SHALL show empty table structure with headers

WHEN patient links are hovered
THE SYSTEM SHALL change text color to gray for visual feedback

---

Lab Test Results Display (Doctor Role):
WHEN the dashboard loads for a user with doctor role
THE SYSTEM SHALL display the "Today's Lab Test Results" table section

WHEN the dashboard loads for a non-doctor user
THE SYSTEM SHALL hide the "Today's Lab Test Results" table section completely

WHEN lab test results are displayed for doctors
THE SYSTEM SHALL show columns: Patient #, Patient Name, Lab Test, Date, Status, Action

WHEN displaying lab test results
THE SYSTEM SHALL filter completed lab tests to show only today's tests

WHEN lab test patient names are displayed
THE SYSTEM SHALL create clickable links that navigate to patientinfo.html with patient_id parameter

WHEN lab test dates are displayed
THE SYSTEM SHALL format dates in "MMM DD, YYYY" format

WHEN lab test status is displayed
THE SYSTEM SHALL show status as a styled badge with "Complete" status and green coloring

WHEN lab test results include View buttons
THE SYSTEM SHALL enable clicking to open the lab result in a modal overlay

WHEN no lab test results are found for today
THE SYSTEM SHALL display message "No completed lab tests for today" in the table

WHEN the lab results table is displayed
THE SYSTEM SHALL include a "See All" link that navigates to laboratory.html

---

Lab Result Modal Functionality:
WHEN a doctor clicks the "View" button for a lab test result
THE SYSTEM SHALL open a modal overlay displaying the lab test form in an iframe

WHEN opening the lab result modal
THE SYSTEM SHALL determine the correct lab form type based on the test name (urinalysis, blood-chemistry, hematology, etc.)

WHEN the lab result modal opens
THE SYSTEM SHALL load the appropriate form in the iframe and send test data via postMessage

WHEN the lab result modal is displayed
THE SYSTEM SHALL show a close button (X) in the top-right corner

WHEN a user clicks the close button in the lab modal
THE SYSTEM SHALL close the overlay and clear the iframe source

WHEN a user clicks outside the modal container
THE SYSTEM SHALL close the lab overlay modal

WHEN a user presses the Escape key while modal is open
THE SYSTEM SHALL close the lab overlay modal

WHEN the lab form within the modal sends a close message
THE SYSTEM SHALL close the modal and refresh lab test results if data was updated

---

Real-time Data Updates:
WHEN the dashboard is displayed
THE SYSTEM SHALL automatically refresh appointment data every 10 seconds

WHEN the dashboard is displayed
THE SYSTEM SHALL automatically refresh current patient data every 10 seconds

WHEN the dashboard is displayed and user is a doctor
THE SYSTEM SHALL automatically refresh lab test results every 30 seconds

WHEN any data refresh occurs
THE SYSTEM SHALL update the display without requiring user interaction or page reload

---

Error Handling and Fallbacks:
WHEN API endpoints are unreachable for appointments data
THE SYSTEM SHALL display "0" for appointment counts and "Error" for current patient

WHEN API endpoints are unreachable for lab test data
THE SYSTEM SHALL display "Error loading lab results" message in the lab results table

WHEN appointment data fails to load
THE SYSTEM SHALL display empty appointments table without breaking page layout

WHEN patient data is missing or incomplete
THE SYSTEM SHALL display "N/A" for missing fields rather than showing undefined values

WHEN data fetching fails
THE SYSTEM SHALL log errors to console and maintain existing display data

---

Responsive Design and Styling:
WHEN the dashboard is displayed
THE SYSTEM SHALL apply gradient background with proper font families and spacing

WHEN dashboard cards and tables are displayed
THE SYSTEM SHALL apply consistent styling with shadow effects and border radius

WHEN interactive elements are displayed
THE SYSTEM SHALL provide visual feedback through hover effects and transitions

WHEN the dashboard displays data
THE SYSTEM SHALL use consistent formatting for names, dates, and times across all sections

WHEN the dashboard layout is rendered
THE SYSTEM SHALL maintain proper margins and spacing with fixed sidebar at 200px width

WHEN tables contain long text content
THE SYSTEM SHALL handle text overflow with ellipsis and maintain table layout integrity