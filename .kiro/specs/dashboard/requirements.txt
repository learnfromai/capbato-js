Page Load and User Session:
WHEN a user navigates to the dashboard page (index.html)
THE SYSTEM SHALL read user role and username from localStorage or sessionStorage for display

WHEN the dashboard page loads
THE SYSTEM SHALL set the page title to "M.G. Amores Medical Clinic"

---

Header Display and User Information:
WHEN the dashboard page loads with user information
THE SYSTEM SHALL display the clinic logo and name "M.G. Amores Medical Clinic" in the header

WHEN user information is loaded
THE SYSTEM SHALL display the user's role (capitalized) in the header

WHEN user information is loaded
THE SYSTEM SHALL display the username in the header below the role

WHEN user information is loaded
THE SYSTEM SHALL generate and display profile avatar with user initials and random color based on username

---

Profile Avatar and Dropdown Functionality:
WHEN a user clicks on the profile avatar
THE SYSTEM SHALL toggle the profile dropdown menu with Settings and Logout options

WHEN a user clicks outside the profile dropdown
THE SYSTEM SHALL close the dropdown menu

WHEN a user clicks the Settings option in dropdown
THE SYSTEM SHALL display "Settings functionality coming soon!" alert and close dropdown

WHEN a user clicks the Logout option in dropdown
THE SYSTEM SHALL clear all authentication data from localStorage and redirect to login.html

---

Sidebar Navigation:
WHEN the dashboard page loads
THE SYSTEM SHALL display fixed sidebar with navigation items: Dashboard, Appointments, Patients, Laboratory, Prescriptions, Doctors

WHEN user role is admin
THE SYSTEM SHALL dynamically add "Accounts" navigation item to the sidebar

WHEN dashboard page is active
THE SYSTEM SHALL highlight the Dashboard navigation item as active with visual indicators

WHEN a user clicks any sidebar navigation item
THE SYSTEM SHALL navigate to the corresponding page

WHEN a user hovers over a sidebar navigation item
THE SYSTEM SHALL show hover effect with color change and visual feedback

---

Summary Cards Display:
WHEN the dashboard loads
THE SYSTEM SHALL display three summary cards: Doctor, Current Patient, and Total Appointments

WHEN the dashboard loads
THE SYSTEM SHALL display "Dr. Smith (Assigned)" in the Doctor card

WHEN the dashboard loads
THE SYSTEM SHALL fetch and display the current patient based on closest appointment time to now

WHEN no current patient is found
THE SYSTEM SHALL display "N/A" in the Current Patient card

WHEN the dashboard loads
THE SYSTEM SHALL fetch and display today's total confirmed appointments count

WHEN the dashboard loads
THE SYSTEM SHALL display today's formatted date in DD MMM YYYY format in the Total Appointments card

---

Today's Appointments Table:
WHEN the dashboard loads
THE SYSTEM SHALL display "Today's Appointments" table with columns: Patient #, Patient, Reason for visit, Contact, Time, Doctor, Status

WHEN the dashboard loads
THE SYSTEM SHALL fetch and display appointments for today that are scheduled at or after the current time

WHEN displaying appointment times
THE SYSTEM SHALL format times in 12-hour format with AM/PM

WHEN displaying patient names
THE SYSTEM SHALL format names with proper capitalization (first letter of each word capitalized)

WHEN displaying patient names in the appointments table
THE SYSTEM SHALL create clickable links that navigate to patientinfo.html with the patient_id parameter

WHEN the appointments table is displayed
THE SYSTEM SHALL include a "See All" link that navigates to appointments.html

WHEN no appointments are found for display
THE SYSTEM SHALL show empty table structure with headers

---

Lab Results Display (Doctor Role):
WHEN the dashboard loads for a user with doctor role
THE SYSTEM SHALL display the "Today's Lab Test Results" table section

WHEN the dashboard loads for a non-doctor user
THE SYSTEM SHALL hide the "Today's Lab Test Results" table section

WHEN displaying lab results for doctors
THE SYSTEM SHALL fetch completed lab tests filtered for today's date only

WHEN lab test results are displayed
THE SYSTEM SHALL show columns: Patient #, Patient Name, Lab Test, Date, Status, Action

WHEN displaying lab test patient names
THE SYSTEM SHALL create clickable links that navigate to patientinfo.html with the patient_id parameter

WHEN displaying lab test dates
THE SYSTEM SHALL format dates in MM/DD/YYYY format with abbreviated month names

WHEN displaying lab test status
THE SYSTEM SHALL show status as a styled badge with "Complete" status and green coloring

WHEN lab test results include a View button
THE SYSTEM SHALL enable clicking to open the lab result in a modal overlay

WHEN no lab test results are found for today
THE SYSTEM SHALL display a message "No completed lab tests for today" in the table

WHEN the lab results table is displayed
THE SYSTEM SHALL include a "See All" link that navigates to laboratory.html

---

Lab Result Modal Functionality:
WHEN a doctor clicks the "View" button for a lab test result
THE SYSTEM SHALL open a modal overlay displaying the lab test form

WHEN opening the lab result modal
THE SYSTEM SHALL determine the correct lab form based on the test type using test name mapping

WHEN the lab result modal opens
THE SYSTEM SHALL load the appropriate form in an iframe and pass the lab data via postMessage

WHEN the lab result modal is displayed
THE SYSTEM SHALL show a close button (X) in the top-right corner

WHEN a user clicks the close button or clicks outside the modal
THE SYSTEM SHALL close the modal and clear the iframe source

WHEN a user presses the Escape key while the modal is open
THE SYSTEM SHALL close the modal

WHEN the lab form within the modal sends a close message
THE SYSTEM SHALL close the modal and refresh lab test results if data was updated

---

Real-time Data Updates:
WHEN the dashboard is active
THE SYSTEM SHALL automatically refresh appointment data every 10 seconds

WHEN the dashboard is active
THE SYSTEM SHALL automatically refresh current patient data every 10 seconds

WHEN the dashboard is active for doctors
THE SYSTEM SHALL automatically refresh lab test results every 30 seconds

WHEN any data refresh occurs
THE SYSTEM SHALL update the display without requiring user interaction or page reload

---

Error Handling and Fallbacks:
WHEN API calls fail for dashboard data
THE SYSTEM SHALL log errors to console and display fallback values

WHEN appointment data fails to load
THE SYSTEM SHALL display "Error" in the current patient field and show empty appointments table

WHEN lab results fail to load for doctors
THE SYSTEM SHALL display "Error loading lab results" message in the lab results table

WHEN current patient data fails to load
THE SYSTEM SHALL display "Error" in the current patient summary card

---

Navigation and User Interactions:
WHEN patient links are clicked in any table
THE SYSTEM SHALL navigate to patientinfo.html with patient_id as URL parameter

WHEN "See All" links are clicked
THE SYSTEM SHALL navigate to the corresponding full page (appointments.html or laboratory.html)

WHEN any clickable element is hovered
THE SYSTEM SHALL provide visual feedback through color changes or transformations

---

Responsive Design and Styling:
WHEN the dashboard is displayed on different screen sizes
THE SYSTEM SHALL maintain usable layout and navigation functionality

WHEN tables contain long text content
THE SYSTEM SHALL handle text overflow with ellipsis and maintain table structure

WHEN cards and tables are displayed
THE SYSTEM SHALL apply consistent shadow effects and border radius for visual coherence

WHEN status information is displayed
THE SYSTEM SHALL use color coding to indicate different states (complete status with green coloring)

WHEN interactive elements are displayed
THE SYSTEM SHALL provide appropriate hover effects and transition animations